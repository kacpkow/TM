{"ast":null,"code":"import _regeneratorRuntime from \"/home/kacper/Pulpit/prg/TK/tk-pro/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/kacper/Pulpit/prg/TK/tk-pro/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/home/kacper/Pulpit/prg/TK/tk-pro/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/kacper/Pulpit/prg/TK/tk-pro/src/views/Editor.js\";\nimport React, { useState, useEffect } from 'react';\nimport useTitle from '../hooks/useTitle';\nimport useApi from '../hooks/useApi';\nimport SvgCanvas from '../components/SvgCanvas';\nimport Loading from '../components/Loading';\nimport AlertContext from '../contexts/Alert';\nimport { ALERT_VARIANTS } from '../config/constants';\nexport default (function (_ref) {\n  var history = _ref.history,\n      params = _ref.match.params;\n  useTitle('Dodaj grafikę');\n  var api = useApi();\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      data = _useState2[0],\n      setData = _useState2[1];\n\n  var _useState3 = useState(true),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isLoading = _useState4[0],\n      setIsLoading = _useState4[1];\n\n  var _AlertContext = AlertContext(),\n      createAlert = _AlertContext.createAlert;\n\n  var fetchItem =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var response;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setIsLoading(true);\n              _context.prev = 1;\n              _context.next = 4;\n              return api.get(\"/api/editor/\".concat(params.id, \"/\"));\n\n            case 4:\n              response = _context.sent;\n              _context.next = 11;\n              break;\n\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](1);\n              createAlert(\"B\\u0142\\u0105d pobierania danych z serwisu \".concat(String.fromCodePoint(0x26a0)), ALERT_VARIANTS.danger);\n              return _context.abrupt(\"return\");\n\n            case 11:\n              setData(JSON.parse(response.data.config));\n              setIsLoading(false);\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 7]]);\n    }));\n\n    return function fetchItem() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    if (params.id) {\n      fetchItem();\n    }\n\n    setIsLoading(false);\n  }, []);\n\n  var save =\n  /*#__PURE__*/\n  function () {\n    var _ref4 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2(_ref3) {\n      var config, source, s, file, response, formData;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              config = _ref3.config, source = _ref3.source;\n              s = new XMLSerializer().serializeToString(source);\n              file = window.btoa(s);\n              setIsLoading(true);\n              setData(config);\n              _context2.prev = 5;\n              _context2.next = 8;\n              return api({\n                url: \"api/editor/\".concat(params.id ? \"\".concat(params.id, \"/\") : ''),\n                method: params.id ? 'put' : 'post',\n                data: {\n                  config: JSON.stringify(config),\n                  source: source\n                }\n              });\n\n            case 8:\n              response = _context2.sent;\n              _context2.next = 15;\n              break;\n\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](5);\n              createAlert(\"B\\u0142\\u0105d pobierania danych z serwisu \".concat(String.fromCodePoint(0x26a0)), ALERT_VARIANTS.danger);\n              return _context2.abrupt(\"return\");\n\n            case 15:\n              formData = new FormData();\n              formData.append('pic', file);\n              formData.append('pic_text', fields.pic_text || '');\n              _context2.prev = 18;\n              _context2.next = 21;\n              return api.post('/api/upload_image/', formData);\n\n            case 21:\n              setFile(null);\n\n              if (onDone) {\n                onDone();\n              }\n\n              createAlert(\"Plik zosta\\u0142 wgrany pomy\\u015Blnie \".concat(String.fromCodePoint(0x1f386)), ALERT_VARIANTS.success);\n              _context2.next = 30;\n              break;\n\n            case 26:\n              _context2.prev = 26;\n              _context2.t1 = _context2[\"catch\"](18);\n              createAlert(\"B\\u0142\\u0105d podczas dodawania pliku \".concat(String.fromCodePoint(0x26a0)), ALERT_VARIANTS.danger);\n              setErrors(_context2.t1.response.data);\n\n            case 30:\n              if (!params.id) {\n                history.push(\"/edytor/\".concat(response.data.id));\n              }\n\n              setIsLoading(false);\n              createAlert(\"Sukces, obraz zosta\\u0142 pomy\\u015Blnie zapisany \".concat(String.fromCodePoint(0x26a0)), ALERT_VARIANTS.success);\n\n            case 33:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[5, 11], [18, 26]]);\n    }));\n\n    return function save(_x) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  return React.createElement(Loading, {\n    isActive: isLoading,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107\n    },\n    __self: this\n  }, React.createElement(SvgCanvas, {\n    initialValue: data,\n    save: save,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108\n    },\n    __self: this\n  }));\n});","map":{"version":3,"sources":["/home/kacper/Pulpit/prg/TK/tk-pro/src/views/Editor.js"],"names":["React","useState","useEffect","useTitle","useApi","SvgCanvas","Loading","AlertContext","ALERT_VARIANTS","history","params","match","api","data","setData","isLoading","setIsLoading","createAlert","fetchItem","get","id","response","String","fromCodePoint","danger","JSON","parse","config","save","source","s","XMLSerializer","serializeToString","file","window","btoa","url","method","stringify","formData","FormData","append","fields","pic_text","post","setFile","onDone","success","setErrors","push"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport useTitle from '../hooks/useTitle';\nimport useApi from '../hooks/useApi';\nimport SvgCanvas from '../components/SvgCanvas';\nimport Loading from '../components/Loading';\nimport AlertContext from '../contexts/Alert';\nimport { ALERT_VARIANTS } from '../config/constants';\n\nexport default ({ history, match: { params } }) => {\n  useTitle('Dodaj grafikę');\n\n  const api = useApi();\n  const [data, setData] = useState([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const { createAlert } = AlertContext();\n\n  const fetchItem = async () => {\n    setIsLoading(true);\n\n    let response;\n\n    try {\n      response = await api.get(`/api/editor/${params.id}/`);\n    } catch (error) {\n      createAlert(\n        `Błąd pobierania danych z serwisu ${String.fromCodePoint(0x26a0)}`,\n        ALERT_VARIANTS.danger\n      );\n      return;\n    }\n\n    setData(JSON.parse(response.data.config));\n    setIsLoading(false);\n  };\n\n  useEffect(() => {\n    if (params.id) {\n      fetchItem();\n    }\n    setIsLoading(false);\n  }, []);\n\n  const save = async ({ config, source }) => {\n    const s = new XMLSerializer().serializeToString(source);\n    const file = window.btoa(s);\n    setIsLoading(true);\n    setData(config);\n\n    let response;\n\n    try {\n      response = await api({\n        url: `api/editor/${params.id ? `${params.id}/` : ''}`,\n        method: params.id ? 'put' : 'post',\n        data: {\n          config: JSON.stringify(config),\n          source\n        }\n      });\n    } catch (error) {\n      createAlert(\n        `Błąd pobierania danych z serwisu ${String.fromCodePoint(0x26a0)}`,\n        ALERT_VARIANTS.danger\n      );\n      return;\n    }\n\n    const formData = new FormData();\n\n\n    formData.append('pic', file);\n    formData.append('pic_text', fields.pic_text || '');\n\n    try {\n      await api.post('/api/upload_image/', formData);\n\n      setFile(null);\n\n      if (onDone) {\n        onDone();\n      }\n\n      createAlert(\n        `Plik został wgrany pomyślnie ${String.fromCodePoint(0x1f386)}`,\n        ALERT_VARIANTS.success\n      );\n    } catch (ex) {\n      createAlert(\n        `Błąd podczas dodawania pliku ${String.fromCodePoint(0x26a0)}`,\n        ALERT_VARIANTS.danger\n      );\n      setErrors(ex.response.data);\n    }\n\n    if (!params.id) {\n      history.push(`/edytor/${response.data.id}`);\n    }\n\n    setIsLoading(false);\n    createAlert(\n      `Sukces, obraz został pomyślnie zapisany ${String.fromCodePoint(0x26a0)}`,\n      ALERT_VARIANTS.success\n    );\n  };\n\n  return (\n    <Loading isActive={isLoading}>\n      <SvgCanvas initialValue={data} save={save} />\n    </Loading>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}